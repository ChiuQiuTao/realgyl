<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>企业认证</title>
    <link rel="stylesheet" href="../../../public/dist/css/layui.css">
    <link rel="stylesheet" href="../../../css/enterprisecertification.css">
    <link rel="stylesheet" href="../../../public/font/iconfont.css">
</head>
<style>
    .select-item-text {
        width: 140px;
    }
</style>

<body>
    <form class="layui-form" action="">
        <div class="container">
            <div class="header">
                <div class="header-line">
                    <div class="header-icon">
                        <i class="layui-icon " style="font-size: 38px; color: #fff;"></i>
                    </div>
                    <div class="line"></div>
                    <div class="header-icon">
                        <i class="layui-icon  " style="font-size: 38px; color: #fff;"></i>
                    </div>
                    <div class="line"></div>
                    <div class="header-icon">
                        <i class="layui-icon " style="font-size: 38px; color: #fff;"></i>
                    </div>
                </div>

                <div class="header-content">

                    <div class="header-content-item">
                        <div class="header-content-txt">营业执照</div>
                        <div class="header-content-btn" id="ok1">未录入</div>
                    </div>
                    <div class="header-content-item">
                        <div class="header-content-txt">法人身份证</div>
                        <div class="header-content-btn" id="ok2">未录入</div>
                    </div>
                    <div class="header-content-item">
                        <div class="header-content-txt">授权书认证</div>
                        <div class="header-content-btn" id="ok3">未录入</div>
                    </div>
                </div>

            </div>



            <div class="content">
                <div class="license">
                    <div class="license-nav">
                        营业执照
                        <div class="btn" id="ok4">
                            未录入
                        </div>
                    </div>
                    <div class="license-content">
                        <img class="license-img" src="" id="ok5">



                        <div class="license-txt">
                            企业认证，分为企业信息认证，法人认证以及管理员授权认证，对申请使用企业动力云平台的企业进行“企业的合法性、真实性”的核实，以及“申请人是否隶属该企业且经过企业授权”的查证；通过认证的企业，方拥有企业动力云平台的所有功能操作的权限。
                        </div>
                    </div>

                    <div id="rerererre">
                        <div class="select">

                            <div class="select-item">
                                <div class="select-item-text">
                                    联系人
                                </div>
                                <input type="text" class="layui-input select-item-input   linkman">
                            </div>

                            <div class="select-item">
                                <div class="select-item-text">
                                    联系人电话
                                </div>
                                <input type="text" class="layui-input select-item-input   telephone" maxlength="11">
                            </div>

                            <div class="select-item">
                                <div class="select-item-text">
                                    证件有效期
                                </div>
                                <input type="text" class="layui-input select-item-input" id="youx">
                                <div class="tip-btn" style="cursor: pointer;">
                                    长期
                                </div>
                            </div>

                            <div class="select-item">
                                <div class="select-item-text">
                                    省
                                </div>
                                <select name="sen" lay-filter="sen" class="select-item-select2" id="sheng"></select>
                            </div>

                            <div class="select-item">
                                <div class="select-item-text">
                                    市
                                </div>
                                <select class="select-item-select2" id="shi" lay-filter="shis" name="shi"></select>
                            </div>

                            <div class="select-item">
                                <div class="select-item-text">
                                    区
                                </div>
                                <select class="select-item-select2" id="qu" lay-filter="qus" name="qu"></select>
                            </div>


                            <div class="select-item2">
                                <div class="select-item-text">
                                    注册企业详细地址
                                </div>
                                <textarea class="select-area  dizi"></textarea>
                            </div>
                        </div>

                        <div class="upload">
                            <div class="upload-nav">
                                上传证件(图片大小不得超过2M)
                            </div>
                            <div class="upload-content" style="display: flex;">
                                <div style="margin-right: 10px;">
                                    <img src="" alt="" id="ingss">
                                    <div class="upload-btns">
                                        <div class="upload-btn" style="cursor: pointer;margin-left: 25px;" id="shang">上传</div>
                                        <!-- <div class="upload-btn" style="cursor: pointer;">删除</div> -->
                                    </div>
                                    <div class="upload-txt">营业执照</div>
                                </div>

                                <!-- <div>
                                <img src="" alt="" id="fardden">
                                <div class="upload-btns">
                                    <div class="upload-btn" style="cursor: pointer;margin-left: 25px;" id="faren">上传</div>
                                    <div class="upload-btn" style="cursor: pointer;">删除</div>
                                </div>
                                <div class="upload-txt" style="width: 110px;">法人身份证(正面)</div>
                            </div>-->

                            </div>
                        </div>
                    </div>


                </div>

                <div class="save" id="bao" style="cursor:pointer;">保存</div>
            </div>
        </div>

    </form>


</body>
<script src="../../../public/dist/layui.js" charset="utf-8"></script>
<!-- <script src="../../../js/enterprisecertification.js" charset="utf-8"></script> -->
<script src="../../../js/common/jquery.min.js"></script>
<script src="../../../js/common/api.js"></script>
<script src="../../../js/module/jquery-3.4.1.min.js"></script>
<script>
</script>

</html>
<script>
    layui.use(['upload', 'form', 'element', 'table', "layer", "laydate", "util"], function() {
        var $ = layui.jquery,
            table = layui.table,
            layer = layui.layer,
            laydate = layui.laydate,
            util = layui.util,
            form = layui.form,
            element = layui.element,
            obj = {},
            upload = layui.upload;

        laydate.render({
            elem: '#youx' //指定元素
        });



        //判断是否认证
        handleAjax("coa/getCoBusinessInfo", obj, "get", "utf-8").done(function(resp) {
            console.log(resp)
            if (resp.code == 10000) {

                if (resp.list[0].linkman != null && resp.list[0].businessNo != null) {
                    $(".header-icon>i").attr("class", "layui-icon layui-icon-ok-circle");
                    $("#rerererre").css("display", "none");
                    $("#ok5").attr("src", resp.list[0].businessNo);
                } else {
                    $(".header-icon>i").attr("class", "layui-icon layui-icon-circle");
                    $("#rerererre").css("display", "block");
                    // layui-icon-ok-circle
                }
            }
            return
        }).fail(function(err) {
            console.log(err)
        });


        //省
        handleAjax('enterprise/getProvincecity', {}, "GET").done(function(resp) {
            console.log(resp)
            $.each(resp.list, function(index, item) {
                $('#sheng').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
            });
            form.render();
            return
        }).fail(function(err) {
            console.log(err)
        });


        //市
        form.on('select(sen)', function(data) {
            obj.state = $(this)[0].innerText
            handleAjax('enterprise/getProvincecity', {
                parentid: data.value
            }, "GET").done(function(resp) {
                $.each(resp.list, function(index, item) {
                    $('#shi').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)
            });
            return
        })

        //区
        form.on('select(shis)', function(data) {
            obj.city = $(this)[0].innerText
            handleAjax('enterprise/getProvincecity', {
                parentid: data.value
            }, "GET").done(function(resp) {
                $.each(resp.list, function(index, item) {
                    $('#qu').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)
            });
            return
        })


        //区
        form.on('select(qus)', function(data) {
            obj.district = $(this)[0].innerText
            return
        })


        //上传图片营业
        upload.render({
            elem: '#shang',
            url: base + 'common/upload',
            method: "post",
            data: {
                file: "营业执照",
            },
            headers: {
                Authorization: "Bearer" + " " + sessions
            },
            done: function(res) {
                console.log(res)
                $("#ingss").attr("src", res.list[0]);
                obj.idCardImage = res.list[0];
                $("#ok1").text("已录入");
                $("#ok2").text("已录入");
                $("#ok4").text("已录入");
                $("#ok5").attr("src", res.list[0]);

                $(".header-icon").eq(0).children().attr("class", "layui-icon layui-icon-ok-circle");
                $(".header-icon").eq(1).children().attr("class", "layui-icon layui-icon-ok-circle");
            },
            error: function() {
                //请求异常回调
            }
        });


        $(".telephone").blur(function() {
            if (!(/^1[3456789]\d{9}$/.test($(this).val()))) {
                alert("请输入正确的手机号");
                $(this).val("");
                return false;
            }
        })

        $(".tip-btn").click(function() {
            if ($(this).text() == "长期") {
                $(this).text("短期");
            } else {
                $(this).text("长期");
            }
        })

        $("#bao").click(function() {

            if ($(".linkman").val() == "") {
                layer.msg("请输入联系人");
                return
            }
            if ($(".telephone").val() == "") {
                layer.msg("请输入联系人电话");
                return
            }
            if ($("#youx").val() == "") {
                layer.msg("请选择证件有效期");
                return
            }

            if ($("#shi").val() == null) {
                layer.msg("请选择市区");
                return
            }

            if ($("#qu").val() == null) {
                layer.msg("请选择区域");
                return
            }


            if ($(".dizi").val() == null) {
                layer.msg("请输入详细地址");
                return
            }

            if (!obj.idCardImage) {
                layer.msg("请上传营业执照");
                return
            }


            obj.linkman = $(".linkman").val();
            obj.telephone = $(".telephone").val();
            obj.validDate = $("#youx").val() + "  " + "00:00:00";
            obj.licenseImage = $(".dizi").val();
            obj.isLongTime = $(".tip-btn").text().trim();

            obj = JSON.stringify(obj);
            handleAjax('coa/addCoBusinessInfo', obj, "GET", "utf-8").done(function(resp) {
                console.log(resp)
                if (resp.code == 10000) {
                    layer.msg('操作成功', {
                        icon: 1,
                        time: 1000
                    });
                    setTimeout(function() {
                        window.location.reload();
                    }, 1500)
                    return
                }
                return
            }).fail(function(err) {
                console.log(err)
            });
        })


    })
</script>