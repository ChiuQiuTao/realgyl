<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    
    <title>企业资料</title>
    <link rel="stylesheet" href="../../../public/dist/css/layui.css">
    <link rel="stylesheet" href="../../../css/enterprisedata.css">
    <link rel="stylesheet" href="../../../public/font/iconfont.css">
</head>
<body>
    <!-- 查询 -->
    <form class="layui-form layui-form-pane" action="" lay-filter="example" id="example">
        <div class="select">
            <div class="select-left">
                <input type="text" class="layui-input select-item-input" name="imgpath1" id="imgpath1" style="display: none">
                <input type="text" class="layui-input select-item-input" name="imgpath2" id="imgpath2" style="display: none">

                <!--  style="display: none" -->
                <div class="select-item">
                    <div class="select-item-text">
                        公司代号
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s1">
                </div>
                <div class="select-item">
                    <div class="select-item-text">
                        中文名称
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s2">
                </div>

                

                <div class="select-item">
                    <div class="select-item-text">
                        中文地址
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s3">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        电话号码
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s4">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        传真号码
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s5">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        网址
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s6">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        负责人
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s7">
                </div>
                <div class="select-item">
                            <div class="select-item-text">
                                    所在地区
                                </div>
                        <div class="layui-inline-sel" style="display: flex;">
                            <select name="country" lay-filter="aihao" id='state'>
                                <option value="0086">中国</option>
                            </select>
                        </div>
                </div>
                <div class="select-item">
                    <div class="layui-inline">
                        <div class="layui-inline-sel" style="display: flex;">
                            
                            <select name="province" lay-filter="province" class="province" id='province' name="s8">
                                <option value="">省</option>
                            </select>

                        </div>
                    </div>
                </div>
                <div class="select-item">
                    <div class="layui-inline">
                        <div class="layui-inline-sel" style="display: flex;">
                           
                            <select name="city" lay-filter="city" class="city" id='city' name="s9">
                                <option value="">市</option>
                            </select>

                          
                        </div>
                    </div>
                </div>
                <div class="select-item">
                    <div class="layui-inline">
                        <div class="layui-inline-sel" style="display: flex;">
                           
                           
                            <select name="area" lay-filter="area" class="area" id='district' name="s10">
                                <option value="">区</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="select-item">
                    <div class="select-item-text">
                        详细地址
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s11">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        邮政编码
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s12">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        电子邮件
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s13">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        行业
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s14">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        官方网址
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s15">
                </div>


                <div class="select-item" style="width:100%;">
                    <div class="select-item-text">
                        备注
                    </div>
                    <textarea id="" class="select-textarea" name="s16"></textarea>
                </div>
                <div class="select-item layui-form-item">
                    <input type="checkbox" title="启用客户分权" lay-skin="primary" name="s17">
                </div>
                <div class="select-item layui-form-item">
                    <input type="checkbox" title="启用供应商分权" lay-skin="primary" name="s18">
                </div>
            

                <div class="select-item">
                    <div class="select-item-text">
                        数字小数位数
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s19">
                </div>


                <div class="select-item">
                    <div class="select-item-text">
                        单价小数位数
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s19">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        金额小数位数
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s20">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        商户号
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s21">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        金融平台账号
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s22">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        金融平台密码
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s23">
                </div>

                <div class="select-item layui-form-item">
                    <input type="checkbox" title="是否发送下一步信息" lay-skin="primary" name="s24">
                </div>

                <div class="select-item">
                    <div class="select-item-text">
                        业务类型
                    </div>
                    <input type="text" class="layui-input select-item-input" name="s25">
                </div>

                <div class="select-item layui-form-item">
                    <input type="checkbox" title="接单引用对方物料基础数据" lay-skin="primary" name="s26">
                </div>


                <div class="select-item layui-form-item">
                    <input type="checkbox" title="启用物料类别分权" lay-skin="primary" name="s27">
                </div>
            </div>



            <!-- <div class="select-right">
                <div class="select-btn">
                    查询
                </div>
                <div class="select-btn">
                    清除
                </div>
                <select name="" id="" class="select-item-select2"  lay-ignore>
                    <option value="">期间</option>
                    <option value="">期间</option>
                    <option value="">期间</option>
                </select>
            </div> -->
        </div>


    <div class="switch">
        <div class="switch-nav">
            <div class="item item-this">
                执照信息
            </div>
            <!-- <div class="item">
                店铺logo
            </div>
            <div class="item">
                店铺banner
            </div>
            <div class="item">
                店铺二维码
            </div> -->
            <div class="item">
                企业二维码
            </div>
        </div>
        <div class="switch-content switch-content-this" id='switch1'>
            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test1">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo1">
                  <p id="demoText1"></p>
                  <div class="uploadimg-txt">营业执照</div>
                </div>
            </div> 

            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test2">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo2">
                  <p id="demoText2"></p>
                  <div class="uploadimg-txt">法人身份证</div>
                </div>
            </div> 
        </div>


        <!-- <div class="switch-content" id='switch2'>
            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test1">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo1">
                  <p id="demoText1"></p>
                  <div class="uploadimg-txt">logo图片</div>
                </div>
            </div> 

            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test2">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo2">
                  <p id="demoText2"></p>
                  <div class="uploadimg-txt">小图片</div>
                </div>
            </div> 
        </div> -->


        <!-- <div class="switch-content" id='switch3'>
            <div class="switch-content-title">应用于供应商首页轮播（尺寸：700 x 500）</div>

            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test1">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo1">
                  <p id="demoText1"></p>
                  <div class="uploadimg-txt">banner01</div>
                </div>
            </div> 

            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test2">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo2">
                  <p id="demoText2"></p>
                  <div class="uploadimg-txt">banner02</div>
                </div>
            </div> 

            <div class="link">
                <div class="select-item" style="width:100%;">
                    <div class="select-item-text" style="width:150px;text-align: left;">
                            banner01链接的网址:
                    </div>
                    <input type="text" class="layui-input select-item-input" style="width:500px;">
                </div>

                <div class="select-item" style="width:100%;">
                    <div class="select-item-text" style="width:150px;text-align: left;">
                            banner02链接的网址:
                    </div>
                    <input type="text" class="layui-input select-item-input" style="width:500px;">
                </div>
        
            </div>
        </div> -->


        <!-- <div class="switch-content" id='switch4'>
            <div class="switch-content-title">应用于供应商首页底部二维码</div>

            <div class="layui-upload">
                <button type="button" class="layui-btn" id="test1">上传图片</button>
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img" id="demo1">
                  <p id="demoText1"></p>
                  <div class="uploadimg-txt">二维码</div>
                </div>
            </div> 

             -->
        </div>


        <div class="switch-content" id='switch5'>
            <div class="switch-content-title">手机与企业形成协同关系</div>
            <div class="layui-upload">
                <!-- <button type="button" class="layui-btn" id="test1">上传图片</button> -->
                <div class="layui-upload-list">
                  <img class="layui-upload-img upload-img upload-img-code" id="demo1">
                  <!-- <p id="demoText1"></p> -->
                  <div class="uploadimg-txt">二维码</div>
                </div>
            </div> 

           
        </div>
    </div>

    

    <div class="layui-form-item" style="margin: 0 auto;display: flex;justify-content: center;margin-top: 20px;">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
            <button type="reset" class="layui-btn cancels">取消</button>
        </div>
    </div>
</form>

</body>
<script src="../../../public/dist/layui.js" charset="utf-8"></script>
<script src="../../../js/common/jquery.min.js"></script>
<script src="../../../js/common/api.js"></script>
<script>
    layui.use(['table','laypage','laydate','upload','form'], function(){
        
      var table = layui.table;
      var laydate = layui.laydate;
      var laypage = layui.laypage
      ,form = layui.form

        ,layer = layui.layer;
      //执行一个laydate实例
      laydate.render({
        elem: '#date1' //指定元素
      });
      laydate.render({
        elem: '#date2' //指定元素
      });


        var $ = layui.jquery
        ,upload = layui.upload;
        
      var switchNav = document.querySelectorAll('.switch-nav .item');
      var switchContent = document.querySelectorAll('.switch-content');
      for(var i=0;i<switchNav.length;i++){
          (function(i){
            switchNav[i].addEventListener('click',function(){
                document.querySelector('.switch-nav .item-this').classList.remove('item-this');
                document.querySelector('.switch-content-this').classList.remove('switch-content-this');
                switchNav[i].classList.add('item-this');
                switchContent[i].classList.add('switch-content-this');

            })
          })(i)
      }

        getProvince();
        //选择框列表加载
        function getProvince(e) {
            handleAjax('enterprise/getProvincecity', { parentid: e }, "GET").done(function(resp) {


                $.each(resp.list, function(index, item) {
                    $('.province').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)

            });
        }

        function getCity(e) {
            handleAjax('enterprise/getProvincecity', { parentid: e }, "GET").done(function(resp) {


                $.each(resp.list, function(index, item) {
                    $('.city').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)

            });
        }

        function getArea(e) {
            handleAjax('enterprise/getProvincecity', { parentid: e }, "GET").done(function(resp) {


                $.each(resp.list, function(index, item) {
                    $('.area').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)

            });
        }


        form.on('select(province)', function(data) {
            console.log(data.value); //得到被选中的值
            document.querySelector('.city').innerHTML = '<option value="">市</option>';
            document.querySelector('.area').innerHTML = '<option value="">区</option>';
            getCity(data.value);
        });
        form.on('select(city)', function(data) {
            console.log(data.value); //得到被选中的值
            document.querySelector('.area').innerHTML = '<option value="">区</option>';
            getArea(data.value);
        });



        // //普通图片上传
        // var uploadInst = upload.render({
        //     elem: '#test1'
        //     ,url: baseaip+'file/upload'
        //     ,before: function(obj){
        //     //预读本地文件示例，不支持ie8
        //     obj.preview(function(index, file, result){
        //         $('#demo1').attr('src', result); //图片链接（base64）
        //     });
        //     }
        //     ,done: function(res){
        //     //如果上传失败
        //     if(res.code > 0){
        //         return layer.msg('上传成功');
        //     }
        //     //上传成功
        //     }
        //     ,error: function(){
        //     //演示失败状态，并实现重传
        //     var demoText = $('#demoText1');
        //     demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
        //     demoText.find('.demo-reload').on('click', function(){
        //         uploadInst.upload();
        //     });
        //     }
        // });



        // var uploadInst = upload.render({
        //     elem: '#test2'
        //     ,url: '/upload/'
        //     ,before: function(obj){
        //     //预读本地文件示例，不支持ie8
        //     obj.preview(function(index, file, result){
        //         $('#demo2').attr('src', result); //图片链接（base64）
        //     });
        //     }
        //     ,done: function(res){
        //     //如果上传失败
        //     if(res.code > 0){
        //         return layer.msg('上传失败');
        //     }
        //     //上传成功
        //     }
        //     ,error: function(){
        //     //演示失败状态，并实现重传
        //     var demoText = $('#demoText2');
        //     demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
        //     demoText.find('.demo-reload').on('click', function(){
        //         uploadInst.upload();
        //     });
        //     }
        // });
     
      

        
    });


   
</script>
<script>
var dataId = null;
    layui.config({
        base: '../../../js/module/'
    }).use(['Tool','form', 'layedit', 'laydate',"serviceTools","upload"],function () {
        layui.Tool.init();
        var form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,laydate = layui.laydate,
            serviceTools = layui.serviceTools;


            //指定允许上传的文件类型
        layui.upload.render({
            elem: '#test1'
            ,url: base + "common/upload"
            ,accept: 'file'
            ,exts: 'doc|docx|pdf|png|jpg'
            ,field:"file"
            ,headers: {Authorization: 'Bearer'+' '+sessions}
            ,done: function(res){
                console.log(res.list[0]);
                var filePath = res.list[0];
                filePath = filePath.substring(0,filePath.length );
                document.querySelector("#imgpath1").value=filePath;
                $('#demo1').attr('src', filePath)
            }
        });


        //指定允许上传的文件类型
        layui.upload.render({
            elem: '#test2'
            ,url: base + "common/upload"
            ,accept: 'file'
            ,exts: 'doc|docx|pdf|png|jpg'
            ,field:"file"
            ,headers: {Authorization: 'Bearer'+' '+sessions}
            ,done: function(res){
                var filePath = res.list[0];
                filePath = filePath.substring(0,filePath.length);
                document.querySelector("#imgpath2").value=filePath;
                $('#demo2').attr('src', filePath)
            }
        });


        // //指定允许上传的文件类型
        // layui.upload.render({
        //     elem: '#test3'
        //     ,url: baseaip+"file/upload"
        //     ,accept: 'file'
        //     ,exts: 'doc|docx|pdf|png|jpg'
        //     ,field:"file"
        //     ,done: function(res){
        //         var filePath = res.data;
        //         filePath = filePath.substring(0,filePath.length - 1 );
        //         $("#htwj").val("").val(filePath);
        //     }
        // });
        //监听提交
        form.on('submit(demo1)', function(data){
            console.log(JSON.stringify(data.field))
            var type = 'sysenter'
            if ( type === null ){
                alert("数据类型不能为空")
            }else{
                var zd = { id:dataId === null ? "" : dataId,
                    type:type,
                    context:JSON.stringify(data.field),
                    keyword:""
                }
                serviceTools.EditOrSaveOrDelete({
                    parame:zd,
                    url:baseaip+"dictionaries/saveOrUpdate",
                    callback:(function(){
                        // window.history.back(-2);
                    })()
                })

            }
            alert(data.field.id)
            return false;
        });
        // getHrefId();

    });
    // function getHrefId(){
    //     var loc = location.href;
    //     var url = loc.split("?")[1];
    //     if(url && url!=''){
    //         var para = url.split("&");
    //         var len = para.length;
    //         var res = {};
    //         var arr = [];
    //         for(var i=0;i<len;i++){
    //             arr = para[i].split("=");
    //             res[arr[0]] = arr[1];
    //         }
    //         dataId = res.id;
    //         var dataJson = localStorage.getItem([res.id]);
    //         dataJson != null && dataJson.trim().length > 0 ? (function(){
    //             data  = JSON.parse(dataJson);
    //             setForm(data);
    //         })():"";
    //     }else{
    //     }
    // }
    function setForm(data){
        layui.use(['form'], function () {
            layui.form.val('example', JSON.parse(data.context));
        })
    }
    Theoldcuiway('dictionaries/queryType', 
    {   keyword: '',
        type: 'sysenter'
    },
        "GET").done(function(resp) {
        console.log(resp.data[0]);
        dataId=resp.data[0].id
        var context = JSON.parse(resp.data[0].context)
        console.log(context);
        getCity(context.province);
        getArea(context.city);

        document.querySelector('#demo1').src=context.imgpath1;
        document.querySelector('#demo2').src=context.imgpath2;
        setTimeout(function(){
            setForm(resp.data[0]);
        },500)

        return
    }).fail(function(err) {
        console.log(err)

    });

        function getCity(e) {
            handleAjax('enterprise/getProvincecity', { parentid: e }, "GET").done(function(resp) {


                $.each(resp.list, function(index, item) {
                    $('.city').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)

            });
        }

        function getArea(e) {
            handleAjax('enterprise/getProvincecity', { parentid: e }, "GET").done(function(resp) {


                $.each(resp.list, function(index, item) {
                    $('.area').append(new Option(item.fullName, item.code)); // 下拉菜单里添加元素
                });
                layui.form.render("select");
                return
            }).fail(function(err) {
                console.log(err)

            });
        }
    
    </script>
</html>